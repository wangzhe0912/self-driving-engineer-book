## 霍夫变换

现在，我们已经通过灰度变换、平滑滤波和Canny边缘检测等手段，将一副原始图像转换为了一个仅显示物体边缘点的图像。这些点表示的是物体的边缘，但是我们最终的目的仅仅是找到一条或几条边缘线。为了找到我们希望的边缘线，我们需要定义一个线的模型，并用该模型来拟合Canny边缘检测后图像中的点。在一副二维图像中，我们可以认为一条线的定义模型如下：
$$
y = mx + b
$$
在该模型中，包含两个参数m和b。

![霍夫变换](/assets/14.jpg)
如左图所示，在图像空间中，横轴表示x，纵轴表示y，我们通过$$m_0$$和$$b_0$$确定一条直线；而如右图所示，在霍夫空间中，横轴表示m，纵轴表示b，因而用于确定直线的$$m_0$$和$$b_0$$对应到霍夫空间即为一个点。而霍夫变换一种从图像空间到霍夫空间的转换。通过霍夫变换，我们可以将图像空间中的一条直线转换为霍夫空间中的一个点。

那么，有一个问题来了，图像空间中的一条直线对应于霍夫空间中的一个点，那么图像空间中的两条平行线对应到霍夫空间中的两个点有什么关系呢？
![Question1](/assets/15.jpg)
显然，在图像空间中，两条线平行说明两条线的斜率一致但截距不一致，也就是说m相同但b不同，即对应右图中的C选项。

另外一个问题：图像空间中的一条线对应于霍夫空间中的一个点。那么图像空间中的点在霍夫空间中对应于什么呢？

图像空间中的一个点对应有许多可能穿过它的线，而对于这些线它们的m和b有一定的规律。对于某个具体的图像空间中的点($$x_0$$, $$y_0$$)而言，m和b需要满足的条件是：
$$
b = y_0 - x_0m
$$
![霍夫空间](/assets/16.jpg)
因此，从上式可以看出图像空间中的点在霍夫空间中对应于一条直线，即对应于右图的选项A。

那么，对于图像空间中的两个点呢？映射到霍夫空间后又是什么样的呢？
![Question3](/assets/17.jpg)
左图中，图像空间中的两个点的横、纵坐标都不同，因此映射至霍夫空间中，分别对应的两条线的截距和斜率也都不一致，故应该如图C所示，存在交点。

接下来，我们从霍夫空间的角度来思考，假设霍夫空间中存在两条相交的线，且交点为($$m_0$$, $$b_0$$)，那么对应至图像空间应该是什么样的呢？
![Question4](/assets/18.jpg)
霍夫空间中的两条直线分别对应于图像空间中的两个点；而霍夫空间中的交点又对应至图像中的一条直线。因此，对应之前的分析，我们可以得出，霍夫空间中存在两条相交的线，且交点为($$m_0$$, $$b_0$$)时，对应到图像空间中是两个位于$$y = m_0x + b_0$$直线上的点。

![Transform](/assets/19.jpg)
当我们在图像中有一系列散点时，我们可以将这些散点全部转换至霍夫空间，从而在霍夫空间中得到一系列的线。此时，我们可以将霍夫空间切分为网格形状，并定义同时穿过同一个网络的所有线定义为交叉线。

具体来说，我们可以通过Canny边缘检测找出所有属于边缘附件的点，并将这些点转换至霍夫空间。此时，如果在霍夫空间中找到一个有多条直线交叉的位置，我们可以认为该位置对应的图像空间中的直线即为我们寻找的车道线。

需要注意的是，上述的解法有一个缺陷，即对于一条垂直于x轴的直线而言，我们无法使用$$y = mx + b$$表达式来表示该直线，因为对于一条垂直于x轴的直线而言，其斜率为无穷大。因此，在图像空间中，我们不再用$$y = mx + b$$来表示，而转换为极坐标方式$$x \cos\theta_0 + y \sin\theta_0=\rho_0$$。此时，对于霍夫空间而言，其也不再由($$m_0$$, $$b_0$$)表示一个点，而是由($$\theta_0$$, $$\rho_0$$)来表示一个点。如下图所示：
![极坐标霍夫空间](/assets/20.jpg)

其中，$$\rho$$表示该直线到原点之间的垂直距离；$$\theta$$表示原点到直线的垂线与x轴的夹角。
此时，图像中的每条线对应至霍夫空间中的一个点；而图像中的每个点则对应至霍夫空间中的一条正弦曲线。

![Case1](/assets/21.jpg)
因此，如上图所示，在图像空间中，存在一系列点属于同一条直线。而映射至霍夫空间后，它们对应于多条正弦曲线，且所有正弦曲线均有一个交点。

那么，扩展一下呢？当图像空间如左图所示，霍夫空间应该是什么样的呢？
![霍夫空间](/assets/22.jpg)























